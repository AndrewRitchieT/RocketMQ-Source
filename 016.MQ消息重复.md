

MQ消息重复消费的几种情况?

系统间的调用超时

消息重试机制

未及时收到MQ的响应，生产者重复发送消息

消费完消息后，还没来得及提交消息offset，消费者重启了，broker由于没有收到offset，broker会重新发送消息





幂等性解决方案

1.业务判断法，

当系统重复调用，发送一个请求给MQ，查询一下当前MQ里是否存在MQ中。

接口性能下降



2.redis缓存判断（分布式锁setex nx和lua脚本释放）

成功发送消息后，在redis中缓存一个标识，重复调用时，查询是否含有标识

不可靠，有可能发送redis 也失败了。



3.数据库主键重复